{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% block extrastyle %}
<link rel="stylesheet" type="text/css" href="{% static "css/status.css" %}" />
<link rel="stylesheet" type="text/css" href="{% static "css/custom-icons.css" %}" />
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
{% endblock %}

{% block title %}Tableau de bord{% endblock %}

{% block content %}
<div class="temp_status" id="temp_status">
    {% for sensor in data %}
    <div class="frame-spacer">
        <div class="frame" id="frame-{{ sensor.name }}">
            <div class="gauge" id="gauge-{{ sensor.name }}"></div>
            <div class="ilya">{{ sensor.since_when }}</div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="buttons" id="buttons">
    <div class="button" id="graphs">&nbsp;</div>
    <div class="button" id="schedule">&nbsp;</div>
    <div class="button" id="refresh">&nbsp;</div>
</div>
{% endblock %}

{% block script %}
    $('#graphs').button({
        icons: {
            primary: "custom-icon-graphs"
        },
        text: false
    }).click(function() {
        window.location.href="/chauffage/graph/all";
    });
    $('#schedule').button({
        icons: {
            primary: "custom-icon-schedule"
        },
        text: false
    }).click(function() {
        window.location.href="/chauffage/program";
    });
    $('#refresh').button({
        icons: {
            primary: "custom-icon-refresh"
        },
        text: false
    }).click(function() {
        window.location.reload();
    });
    $('#buttons').position({
        my: "center",
        at: "bottom",
        of: "#content"
    });
    $('#temp_status').position({
        my: "center",
        at: "center",
        of: "#content"
    });
    {% for sensor in data %}
        $('#frame-{{ sensor.name }}').click(function() {
            window.location.href="/chauffage/graph/{{ sensor.name|lower }}";
        });
    {% endfor %}

    google.load("visualization", "1.0", {packages:["gauge"]});
    google.setOnLoadCallback(drawChart);

    function drawChart() {

        // Options are common to all gauges
        var options = {
            animation: { startup: true,
                         duration: 1000,
                         easing: 'out'},
            width: 200, height: 200,
            min: -20, max: 40,
            greenFrom: -20, greenTo: 0, greenColor: '#aaaaff',
            yellowFrom: 27, yellowTo: 40, yellowColor: '#ffe773',
            minorTicks: 5
        };

        {% for sensor in data %}
            var data_{{ sensor.name }} = google.visualization.arrayToDataTable([
                ['Label', 'Value'],
                ['{{ sensor.name }}', -20],
            ]);

            var chart_{{ sensor.name }} = new google.visualization.Gauge(document.getElementById('gauge-{{ sensor.name }}'));
            chart_{{ sensor.name }}.draw(data_{{ sensor.name }}, options);
        {% endfor %}

        setTimeout(function() {
            {% for sensor in data %}
                var data_{{ sensor.name }} = google.visualization.arrayToDataTable([
                    ['Label', 'Value'],
                    ['{{ sensor.name }}', {{ sensor.temp }}],
                ]);
                chart_{{ sensor.name }}.draw(data_{{ sensor.name }}, options);
            {% endfor %}
        }, 200);
    }
{% endblock %}

